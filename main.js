(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{I:()=>Q});var t={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"59844c9d-8d8a-441e-8b23-64a7c9cc844e","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r=document.querySelector(".elements"),o=document.querySelector("#element-template").content;function c(e){var t=function(e){var t=o.querySelector(".element").cloneNode(!0);return t._id=e._id,t.querySelector(".element__title").textContent=e.name,t.querySelector(".element__image").src=e.link,t.querySelector(".element__image").alt=e.name,t.querySelector(".element__like-counter").textContent=String(e.likes.length),Q._id!=e.owner._id&&t.querySelector(".element__delete").remove(),e.likes.find((function(e){return e._id===Q._id}))&&t.querySelector(".element__like").classList.add("element__like_active"),t}(e);r.prepend(t)}var a=document.querySelector(".popup_type_edit"),l=document.querySelector(".popup_type_add"),i=document.querySelector(".popup_type_avatar"),u=document.forms.avatarForm,s=u.elements.link,d=document.forms.placeForm,m=d.elements.title,f=d.elements.link,p=document.forms.profileForm,_=p.elements.name,y=p.elements.description,v=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_image"),g=b.querySelector(".popup__image"),q=b.querySelector(".popup__heading"),k=d.querySelector(".popup__save-button"),C=p.querySelector(".popup__save-button"),L=u.querySelector(".popup__save-button");function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.src;v.textContent=e,h.textContent=t,S.src=n}function A(e){e.target.classList.contains("popup__exit-button")?j(e.currentTarget):e.target.classList.contains("popup")&&j(e.target)}function x(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}function O(e,t){e?(console.log(t.textContent),t.textContent="Сохранение..."):t.textContent="Сохранить"}function U(e){document.addEventListener("keydown",x),e.classList.add("popup_opened")}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function B(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w,P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},D=document.querySelectorAll(".popup"),N=document.querySelector(".profile__edit-button"),I=document.querySelector(".profile__add-button"),J=document.querySelector(".profile__image-button"),F=a.querySelector(P.submitButtonSelector),H=l.querySelector(P.submitButtonSelector),M=i.querySelector(P.submitButtonSelector),z=l.querySelector(".popup__form"),$=Array.from(a.querySelectorAll(P.inputSelector)),G=Array.from(l.querySelectorAll(P.inputSelector)),K=Array.from(i.querySelectorAll(P.inputSelector)),Q={};D.forEach((function(e){return e.addEventListener("click",A)})),N.addEventListener("click",(function(){_.value=v.textContent,y.value=h.textContent,B($,F,P.inactiveButtonClass),U(a)})),I.addEventListener("click",(function(){z.reset(),B(G,H,P.inactiveButtonClass),U(l)})),J.addEventListener("click",(function(){B(K,M,P.inactiveButtonClass),U(i)})),p.addEventListener("submit",(function(e){var r;e.preventDefault(),O(!0,C),(r={name:_.value,about:y.value},fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r.name,about:r.about})}).then((function(e){return n(e)}))).then((function(e){E(e.name,e.about),j(a)})).catch((function(e){console.log(e)})).finally((function(){O(!1,C)}))})),d.addEventListener("submit",(function(e){var r;e.preventDefault(),O(!0,k),(r={name:m.value,link:f.value},fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r.name,link:r.link})}).then((function(e){return n(e)}))).then((function(t){c(t),e.target.reset(),j(l)})).catch((function(e){console.log(e)})).finally((function(){O(!1,k)}))})),u.addEventListener("submit",(function(e){var r;e.preventDefault(),O(!0,L),(r=s.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then((function(e){return n(e)}))).then((function(t){S.src=t.avatar,e.target.reset(),j(i)})).catch((function(e){console.log(e)})).finally((function(){O(!1,L)}))})),r.addEventListener("click",(function(e){var r,o,c,a;e.target.classList.contains("element__like")?(r=e.target,c=r.closest(".element__like-container").querySelector(".element__like-counter"),a=r.closest(".element"),r.classList.contains("element__like_active")?(o=a,fetch("".concat(t.baseUrl,"/cards/likes/").concat(o._id),{method:"DELETE",headers:t.headers}).then((function(e){return n(e)}))).then((function(e){r.classList.remove("element__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:t.headers,body:JSON.stringify({_id:e._id})}).then((function(e){return n(e)}))}(a).then((function(e){r.classList.add("element__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))):e.target.classList.contains("element__delete")?function(e){var r=e.closest(".element");(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:t.headers}).then((function(e){return n(e)}))})(r).then((function(){r.remove()})).catch((function(e){console.log(e)}))}(e.target):e.target.classList.contains("element__image")&&(!function(e){g.src=e.querySelector(".element__image").src,g.alt=e.querySelector(".element__image").alt,q.textContent=e.querySelector(".element__title").textContent}(e.target.closest(".element")),U(b))})),w=P,Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),B(n,r,t.inactiveButtonClass)}))}))}(e,w)})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return n(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return n(e)}))]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,l=[],i=!0,u=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(l.push(r.value),l.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];E(n.name,n.about,n.avatar),Q=n;for(var o=r.length-1;o>=0;o--)c(r[o])})).catch((function(e){console.log(e)}))})();